function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.157517,lng:-76.987442},zoom:18,mapTypeId:google.maps.MapTypeId.SATELLITE,mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}}),google.maps.event.addListener(map,"bounds_changed",function(){smallInfoVisible&&setSmallInfoPosition()}),infoWindow=new google.maps.InfoWindow({maxWidth:350}),google.maps.event.addListener(infoWindow,"domready",function(){var e=$(".gm-style-iw"),o=e.prev();o.children(":nth-child(2)").css({display:"none"}),o.children(":nth-child(4)").css({display:"none"}),o.children(":nth-child(3)").find("div").children().css({"box-shadow":"#293e5d 0px 1px 6px","z-index":"1"});e.next();$(".iw-content").height()<140&&$(".iw-bottom-gradient").css({display:"none"})})}function findCategoryByName(e){for(var o=null,i=0;i<categories.length;i++){var n=categories[i];if(n.title==e){o=n;break}}return o}function findCategoryById(e){for(var o=null,i=0;i<categories.length;i++){var n=categories[i];if(n.id==e){o=n;break}}return o}function findLocationById(e){for(var o=null,i=0;i<categories.length;i++)for(var n=categories[i],t=0;t<n.locations.length;t++){var a=n.locations[t];if(a.entry_id==e){o=a;break}}return o}function findMarkerById(e){for(var o=null,i=0;i<markers.length;i++){var n=markers[i];if(n.location.entry_id==e){o=n;break}}return o}function showCategoryMarkers(e,o){var i=findCategoryById(e);if(null!=i)for(var n=0;n<i.locations.length;n++){var t=i.locations[n];o?(t.selected=!0,showLocationMarker(t)):(t.selected=!1,hideLocationMarker(t))}}function showLocationMarker(e){var o=findMarkerById(e.entry_id);if(null==o){var i=findCategoryByName(e.category_name);if(null!=i){var n="images/"+i.icon+".png",t=e.location.split(","),o=addMarker(e,parseFloat(t[0]),parseFloat(t[1]),n);if(o.polygons=new Array,o.childMarkers=new Array,markers.push(o),$(".hide-all-btn").show(),$(".show-hide").hide(),$("#hide-"+i.id).show(),$(".show-hide").show(),e.polyline_coordinates.length>0){var a=e.polyline_coordinates;a=a.slice(1),a=a.slice(0,-1);for(var r=a.split("},{"),l=new Array,s=0;s<r.length;s++){a=r[s];var c=a.split(","),d=new Object;d.lat=parseFloat(c[0]),d.lng=parseFloat(c[1]),l.push(d)}var a=e.polyline_or_polygon_styling,r=a.split(","),g=new google.maps.Polyline({path:l,geodesic:!0,strokeColor:r[0],strokeOpacity:parseFloat(r[1]),strokeWeight:parseInt(r[2])});g.setMap(map),o.polyline=g}if(e.polygon_coordinates.length>0)for(var a=e.polygon_coordinates,p=a.split("|"),u=0;u<p.length;u++){var a=p[u];a=a.slice(1),a=a.slice(0,-1);for(var r=a.split("},{"),l=new Array,s=0;s<r.length;s++){a=r[s];var c=a.split(","),d=new Object;d.lat=parseFloat(c[0]),d.lng=parseFloat(c[1]),l.push(d)}var a=e.polyline_or_polygon_styling,r=a.split(","),h=new google.maps.Polygon({path:l,strokeColor:r[0],strokeOpacity:parseFloat(r[1]),strokeWeight:parseInt(r[2]),fillColor:r[3],fillOpacity:parseFloat(r[4])});h.setMap(map),o.polygons.push(h)}if(e.multiple_locations_new.length>0)for(var a=e.multiple_locations_new,r=a.split("|"),s=0;s<r.length;s++){a=r[s];var c=a.split(","),f=addMarker(e,parseFloat(c[0]),parseFloat(c[1]),n);o.childMarkers.push(f)}}}return o}function addMarker(e,o,i,n){var t=new google.maps.LatLng(o,i),a=new google.maps.Marker({position:t,map:map,icon:n});return a.location=e,"Yes"==e.hide_marker_and_info_box?a.setVisible(!1):(isMobile||(google.maps.event.addListener(a,"mouseover",function(){var e=fromLatLngToPoint(this.getPosition(),map),o=this.location.entry_title;$("#marker-tooltip").html(o).css({left:e.x-10,top:e.y-10}).show()}),google.maps.event.addListener(a,"mouseout",function(){$("#marker-tooltip").hide()})),a.addListener("click",function(){hideMarkers(this),infoBuilding=this.location,infoImageIndex=0,infoData=new Object,infoData.entry_title=infoBuilding.entry_title,infoData.description=infoBuilding.description,infoData.read_more_link=infoBuilding.read_more_link,infoData.image="",infoData.imageCount=infoBuilding.images.length,infoBuilding.images.length>0&&(infoData.image=infoBuilding.images[0]),infoData.location=infoBuilding.location;var e=findCategoryByName(infoBuilding.category_name);if(null!=e&&(infoData.icon=e.icon),infoData.copyLink="",""!=infoBuilding.shortcut){var o=window.location.href;-1!=o.indexOf("?")&&(o=o.substring(0,o.indexOf("?"))),infoData.copyLink=o+"?building="+infoBuilding.shortcut}if(copyLink=infoData.copyLink,hideLargeInfo(),isMobile){var i=(fromLatLngToPoint(a.getPosition(),map),$("#smallLocationInfoTemplate").tmpl(infoData).html());$("#small-info-window").html(i).show(),smallInfoVisible=!0,activeMarker=a,setSmallInfoPosition()}else{var i=$("#locationInfoTemplate").tmpl(infoData).html();infoWindow.setContent(i),infoWindow.open(map,this),$(".gm-style-iw").next("div").show(),$("#locationInfoDescription").html(decodeEntities(infoData.description))}})),a}function hideLocationMarker(e){for(var o=0;o<markers.length;o++){var i=markers[o];if(i.location.entry_id==e.entry_id){for(null!=i.polyline&&i.polyline.setMap(null);i.polygons.length>0;){var n=i.polygons.shift();n.setMap(null)}for(;i.childMarkers.length>0;){var t=i.childMarkers.shift();t.location=null,t.setMap(null)}i.polyline=null,i.polygon=null,i.location=null,i.setMap(null),markers.splice(o,1);break}}0==markers.length&&$(".hide-all-btn").hide()}function fromLatLngToPoint(e,o){var i=o.getProjection().fromLatLngToPoint(o.getBounds().getNorthEast()),n=o.getProjection().fromLatLngToPoint(o.getBounds().getSouthWest()),t=Math.pow(2,o.getZoom()),a=o.getProjection().fromLatLngToPoint(e);return new google.maps.Point((a.x-n.x)*t,(a.y-i.y)*t)}function showInfoWindow(e){var o=findMarkerById(e);if(hideMarkers(o),null==o){var i=findLocationById(e);null!=i&&(o=showLocationMarker(i),focusMarker(o))}else focusMarker(o)}function focusMarker(e){var o=e.getPosition();map.setCenter(o),google.maps.event.trigger(e,"click")}function getURLParameter(e){for(var o="",i=window.location.search.substring(1),n=i.split("&"),t=0;t<n.length;t++){var a=n[t].split("=");if(a[0]==e){o=a[1];break}}return o}function setSmallInfoPosition(){var e=fromLatLngToPoint(activeMarker.getPosition(),map);$("#small-info-window").css({left:e.x-$("#small-info-window").width()/2,top:e.y-$("#small-info-window").height()-55})}function hideSmallInfo(){$("#small-info-window").hide(),smallInfoVisible=!1,activeMarker=null}function hideLargeInfo(){$(".large-info-window").hide()}function showMapView(){$(".tabsContainer").hide(),$(".mainHeader").show()}function showMain(){$(".flexWrapper").show(),$(".mainSearchBar").hide()}function hideMarkers(e){for(var o=0;o<markers.length;){var i=markers[o];if(e==i||i.location.selected)o++;else{var n=i.location.category_name;hideLocationMarker(i.location),checkHideAllButton(n)}}}function checkHideAllButton(e){for(var o=0;o<categories.length;o++){var i=categories[o];if(i.title==e){for(var n=!1,t=0;t<i.locations.length;t++){var a=i.locations[t];if(findMarkerById(a.entry_id)){n=!0;break}}n||$("#hide-"+i.id).hide();break}}}function decodeEntities(e){var o=document.createElement("textarea");return o.innerHTML=e,o.value}var map,infoWindow,markers=new Array,categories=new Array,tours=new Array,infoBuilding,infoImageIndex,copyLink,isMobile,infoData,smallInfoVisible=!1,activeMarker;categories.push({id:1,title:"Admissions",icon:"icon-admissions",expand:!1,group:"1",locations:[],note:""}),categories.push({id:2,title:"Parking",icon:"icon-parking",expand:!1,group:"1",locations:[],note:""}),categories.push({id:3,title:"College Entrances",icon:"icon-college-entrances",expand:!1,group:"1",locations:[],note:""}),categories.push({id:4,title:"Guest Services",icon:"icon-questionmark",expand:!1,group:"1",locations:[],note:""}),categories.push({id:5,title:"Academics and Administrative",icon:"icon-academic-administrative",expand:!1,group:"2",locations:[],note:""}),categories.push({id:6,title:"Athletics and Recreation",icon:"icon-athletics-recreation",expand:!1,group:"2",locations:[],note:""}),categories.push({id:7,title:"ATM locations",icon:"icon-atm",expand:!1,group:"2",locations:[],note:""}),categories.push({id:8,title:"Construction",icon:"icon-construction",expand:!1,group:"2",locations:[],note:""}),categories.push({id:9,title:"Covered Bridge",icon:"icon-covered-bridge",expand:!1,group:"2",locations:[],note:""}),categories.push({id:10,title:"Dining and Retail",icon:"icon-dining-and-retail",expand:!1,group:"2",locations:[],note:""}),categories.push({id:11,title:"Health and Safety",icon:"icon-health-and-safety",expand:!1,group:"2",locations:[],note:""}),categories.push({id:12,title:"Facility and Auxiliary Services",icon:"icon-facility-aux",expand:!1,group:"2",locations:[],note:""}),categories.push({id:13,title:"Music, Theatre and Art",icon:"icon-music-and-theatre",expand:!1,group:"2",locations:[],note:""}),categories.push({id:14,title:"Residences",icon:"icon-residences",expand:!1,group:"2",locations:[],note:""}),categories.push({id:15,title:"Student Life",icon:"icon-student-life",expand:!1,group:"2",locations:[],note:""}),categories.push({id:16,title:"The Oakes Museum of Natural History",icon:"icon-oakes-museum",expand:!1,group:"2",locations:[],note:""}),$(document).ready(function(){isMobile=window.screen.width<=480,isMobile&&showMapView();var e=new Array,o=getURLParameter("category"),i=getURLParameter("building"),n="",t="",n=o,a="https://www.messiah.edu/a/api/directoriesByCategoryJSONP.php?apiKey=a38737a6a302f5f0390169114b6640a6&directoryID=2&categoryID=-1&callback=directory_data";$.ajax({url:a,dataType:"jsonp",jsonpCallback:"directory_data",jsonp:"callback",success:function(a){for(var r=new Array,l=0;l<a.length;l++)if("1"==a[l].live){var s=a[l].category_name;if(""!=s)if("announcement"==s)"1"==a[l].live&&($("#announcement-title").text(a[l].entry_title),$("#announcement-description").text(a[l].description),$("#announcement-back").show());else if("Tours"==s)tours.push(a[l]);else{var c=findCategoryByName(s);if(null!=c)if("category_notes"==a[l].entry_title)r.push(a[l]);else{""!=o&&a[l].category_id==o&&(n=c.id),""!=i&&a[l].shortcut==i&&(t=a[l].entry_id),"Yes"!=a[l].hide_category_expand&&(c.expand=!0);var d="http://www.messiah.edu/images/";if(a[l].images=new Array,""!=a[l].image_1_required&&a[l].images.push(d+a[l].image_1_required),""!=a[l].image_2_optional&&a[l].images.push(d+a[l].image_2_optional),""!=a[l].image_3_optional&&a[l].images.push(d+a[l].image_3_optional),""!=a[l].image_4_optional&&a[l].images.push(d+a[l].image_4_optional),a[l].selected=!1,c.locations.push(a[l]),""==a[l].hide_from_search){var g=a[l].entry_title+" "+a[l].keywords;""!=a[l].keywords&&(g=g+" "+a[l].keywords),searchTerm={label:g,id:a[l].entry_id,title:a[l].entry_title,category:a[l].category_name},e.push(searchTerm)}}}}for(var l=0;l<r.length;l++){var s=r[l].category_name,c=findCategoryByName(s);null!=c&&(c.note=r[l].description)}for(var l=0;l<categories.length;l++)$("#categoryTemplate").tmpl(categories[l]).appendTo(".categories"+categories[l].group);$("#tourTemplate").tmpl(tours).appendTo(".tours"),$("#search").autocomplete({minLength:1,source:e,focus:function(e,o){return!1},select:function(e,o){return $("#search").val(""),showInfoWindow(o.item.id),$(".searchIcon").is(":visible")&&showMain(),!1},open:function(e){navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&$(".ui-autocomplete").off("menufocus hover mouseover"),$(".ui-autocomplete").css("height","auto");var o=$(e.target),i=o.offset().top,n=o.height(),t=$(".ui-autocomplete").height(),a=$(window).height();n+i+t>a&&$(".ui-autocomplete").css("max-height",a-n-i-20+"px")}}).autocomplete("instance")._renderItem=function(e,o){return $("<li>").append("<a><span>"+o.title+"</span><span>"+o.category+"</span></a>").appendTo(e)},""!=n&&$("#check-"+n).trigger("click"),""!=t&&showInfoWindow(t)},error:function(e,o,i){}}),$(".fancybox-media").fancybox({openEffect:"none",closeEffect:"none",helpers:{media:{}}}),$(".sidebarToggle").click(function(){$(this).toggleClass("closed"),$(this).find("> span").toggleClass("icon-doublearrow-left icon-doublearrow-right"),$(".mainSidebarWrapper").toggleClass("closed")}),$(".toggleSearch").on("click",function(){$(".flexWrapper").hide(),$(".mainSearchBar").show()}),$(".searchIcon").on("click",function(){showMain()}),$(".glyphicon-menu-hamburger").on("click",function(){hideSmallInfo(),hideLargeInfo(),$(".mainHeader").hide(),$(".tabsContainer").show()}),$(".backBtn").on("click",function(){showMapView()}),$(document).on("click","#locations-tab",function(e){e.stopPropagation(),$(this).hasClass("active")||($(this).toggleClass("active"),$(this).siblings().removeClass("active"),$("#locations").show(),$("#tours").hide())}),$(document).on("click","#tours-tab",function(e){e.stopPropagation(),$(this).hasClass("active")||($(this).toggleClass("active"),$(this).siblings().removeClass("active"),$("#locations").hide(),$("#tours").show())}),$(document).on("click",".header",function(e){"true"==$(this).attr("data-expand")&&($(this).find(".toggleIcon").toggleClass("icon-chevrondown icon-chevronup"),$(this).find("> ul").slideToggle(200,function(){}))}),$(document).on("click",".show-all",function(e){e.stopPropagation();var o=$(this).parents(".header").attr("data-id");showCategoryMarkers(o,!0),isMobile&&showMapView()}),$(document).on("click",".hide-all",function(e){e.stopPropagation();var o=$(this).parents(".header").attr("data-id");showCategoryMarkers(o,!1),$(this).hide()}),$(document).on("click",".location",function(e){e.stopPropagation();var o=$(this).attr("data-id");showInfoWindow(o),isMobile&&showMapView()}),$(document).on("click","#carousel-left",function(e){infoBuilding.images.length>1&&(0==infoImageIndex?infoImageIndex=infoBuilding.images.length-1:infoImageIndex--,$(".toolTip__image").attr("src",infoBuilding.images[infoImageIndex]))}),$(document).on("click","#carousel-right",function(e){infoBuilding.images.length>1&&(infoImageIndex==infoBuilding.images.length-1?infoImageIndex=0:infoImageIndex++,$(".toolTip__image").attr("src",infoBuilding.images[infoImageIndex]))}),$(document).on("click",".icon-close-btn",function(e){$("#copy-link-panel").hide()}),$(document).on("click",".icon-pop-out",function(e){$("#copy-link-panel").show(),$("#copy-link-edit").val(copyLink),$("#copy-link-edit").focus(),$("#copy-link-edit").select()}),$(document).on("click",".small-info-close",function(e){hideSmallInfo()}),$(document).on("click",".large-info-close",function(e){hideLargeInfo()}),$(document).on("click",".show-location-details",function(e){hideSmallInfo(),$(".large-info-window").html(""),$("#largeLocationInfoTemplate").tmpl(infoData).appendTo(".large-info-window"),$(".large-info-window").show()}),$(document).on("click",".hide-all-btn ",function(e){for(e.stopPropagation();markers.length>0;){var o=markers[0];hideLocationMarker(o.location)}$(".hide-all").hide()}),$(document).on("click",".announcement-close",function(e){$("#announcement-back").hide()})});